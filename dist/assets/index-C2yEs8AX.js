(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function l(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=l(a);fetch(a.href,r)}})();const w=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),o=document.getElementById("gameCanvas"),Le=document.getElementById("gameContainer");function Ee(){w?(o.width=window.innerWidth,o.height=window.innerHeight):(o.width=Math.min(960,window.innerWidth-40),o.height=Math.min(600,window.innerHeight-40)),Le.style.width=o.width+"px",Le.style.height=o.height+"px",console.log("Canvas resized to:",o.width,"x",o.height,"Mobile:",w)}Ee();window.addEventListener("resize",()=>{Ee(),w&&setTimeout(Pe,100)});window.addEventListener("orientationchange",()=>{setTimeout(()=>{Ee(),w&&Pe()},100)});const e=o.getContext("2d");let p={name:"",avatar:null,email:"",subscription:!1,maxLevel:1};function Qe(){const t=localStorage.getItem("dinoWarfareCurrentUser");t&&(p=JSON.parse(t),p.email&&p.email.toLowerCase()==="admin@dino.com"?(p.subscription=!0,p.isAdmin=!0,p.maxLevel=999):p.isAdmin=!1)}function Ze(t){return t<=3||p.subscription?!0:window.checkSubscriptionStatus?window.checkSubscriptionStatus(t):!1}const ae=new Image;ae.src="/sprites/sprites_player.png";const Fe=new Image;Fe.src="/sprites/sprites_raptor.png";const ze=new Image;ze.src="/sprites/sprites_trex.png";const Y=new Image;Y.src="/sprites/sprites_motherdino.png";const et=new Image;et.src="/sprites/sprites_bullet.png";const tt=new Image;tt.src="/sprites/sprites_powerup.png";const Ye=new Image;Ye.src="/sprites/sprites_velociraptor.png";const Ue=new Image;Ue.src="/sprites/sprites_triceratops.png";const Ne=new Image;Ne.src="/sprites/sprites_stegosaurus.png";const Xe=new Image;Xe.src="/sprites/sprites_pterodactyl.png";const je=new Image;je.src="/sprites/sprites_spinosaurus.png";const Ge=new Image;Ge.src="/sprites/sprites_ankylosaurus.png";const Ve=new Image;Ve.src="/sprites/sprites_pachycephalosaurus.png";const se=new Image,we=new Audio("/sounds/sounds_shoot.wav"),Z=new Audio("/sounds/sounds_hit.wav"),ce=new Audio("/sounds/sounds_gameover.wav"),Me=new Audio("/sounds/sounds_regen.wav"),ie=new Audio("/sounds/sounds_shield.wav"),y=new Audio("/sounds/sounds_background.wav"),de=new Audio("/sounds/sounds_boss_intro.mp3");we.addEventListener("error",()=>console.warn("Failed to load shoot sound"));Z.addEventListener("error",()=>console.warn("Failed to load hit sound"));ce.addEventListener("error",()=>console.warn("Failed to load game over sound"));Me.addEventListener("error",()=>console.warn("Failed to load regen sound"));ie.addEventListener("error",()=>console.warn("Failed to load shield sound"));y.addEventListener("error",()=>console.warn("Failed to load background music"));de.addEventListener("error",()=>console.warn("Failed to load boss intro sound"));y.loop=!0;let v=!1,b=!1,f=!1,g=!1,I=0,P=4,T=0,S=1,d=1,ve=0,Se=0,_=!1,he=0;const be=["Love","Joy","Peace","Patience","Kindness","Goodness","Faithfulness","Gentleness","Self-Control","Faith","Hope"];function Be(t){const i=(t-1)%be.length;return be[i]}function N(t){const i=Be(t),l=Math.floor((t-1)/be.length)+1;return l>1?`${i} (Cycle ${l})`:i}let s={x:o.width/2,y:o.height-100,radius:30,speed:8,shield:!1,bulletCooldown:0,bulletSpeed:12,maxBullets:3,bulletSize:4,diagonalShooting:!1},R=[],E=[],D=[],F=[],q=[],X=[],x={};const it=[{img:Fe,speed:2,health:1,points:10,radius:25,level:1,name:"Raptor"},{img:ze,speed:1.5,health:2,points:20,radius:30,level:1,name:"T-Rex"},{img:Ye,speed:3,health:1,points:15,radius:20,level:2,name:"Velociraptor"},{img:Ue,speed:1,health:3,points:25,radius:35,level:2,name:"Triceratops"},{img:Ne,speed:.8,health:4,points:30,radius:40,level:3,name:"Stegosaurus"},{img:Xe,speed:4,health:1,points:20,radius:25,level:3,name:"Pterodactyl"},{img:je,speed:1.2,health:5,points:40,radius:45,level:4,name:"Spinosaurus"},{img:Ge,speed:.6,health:6,points:35,radius:35,level:4,name:"Ankylosaurus"},{img:Ve,speed:2.5,health:3,points:30,radius:30,level:5,name:"Pachycephalosaurus"}],fe=[{img:Y,health:50,speed:1.2,fireRate:60,name:"Mother Dino",level:1,scale:1},{img:Y,health:75,speed:1.5,fireRate:45,name:"Mother Dino Elite",level:2,scale:1.2},{img:Y,health:100,speed:1.8,fireRate:40,name:"Mother Dino Alpha",level:3,scale:1.4},{img:Y,health:150,speed:1,fireRate:30,name:"Mother Dino Supreme",level:4,scale:1.6},{img:Y,health:200,speed:1.3,fireRate:25,name:"Mother Dino Legend",level:5,scale:1.8}],ot=[{type:"regen",color:"green",points:0},{type:"shield",color:"blue",points:0}],lt=[{type:"laser",color:"red",points:0},{type:"shield_plus",color:"cyan",points:0},{type:"time_slow",color:"purple",points:0},{type:"nuke",color:"orange",points:0},{type:"multi_shot",color:"yellow",points:0}];let M=[];const Ce=[{name:"Extra Life",cost:50,effect:"lives",value:1},{name:"Faster Bullets",cost:30,effect:"bulletSpeed",value:2},{name:"More Bullets",cost:40,effect:"maxBullets",value:1},{name:"Bigger Bullets",cost:25,effect:"bulletSize",value:1},{name:"Faster Movement",cost:35,effect:"speed",value:1},{name:"Extra Diagonal Bullets",cost:60,effect:"diagonalShooting",value:!0}];window.addEventListener("keydown",t=>x[t.key]=!0);window.addEventListener("keyup",t=>x[t.key]=!1);let Ie=!1,j=0,re=0,Te=0,ke=0,U=0;function Pe(){if(!w)return;const t=document.getElementById("joystickContainer"),i=document.getElementById("joystickBase"),l=document.getElementById("joystickHandle");if(!t||!i||!l)return;const n=i.getBoundingClientRect();Te=n.left+n.width/2,ke=n.top+n.height/2,U=n.width/2-15,console.log("Joystick initialized:",{baseX:Te,baseY:ke,radius:U})}function $e(t){if(!w)return;const i=t.touches[0]||t.changedTouches[0],l=i.clientX,n=i.clientY,a=l-Te,r=n-ke,c=Math.sqrt(a*a+r*r);c<=U?(j=a/U,re=r/U):(j=a/c,re=r/c);const u=document.getElementById("joystickHandle");if(u){const m=j*U,C=re*U;u.style.transform=`translate(calc(-50% + ${m}px), calc(-50% + ${C}px))`}Ie=!0}function Re(){if(!w)return;Ie=!1,j=0,re=0;const t=document.getElementById("joystickHandle");t&&(t.style.transform="translate(-50%, -50%)")}function nt(){if(!w)return;const t=document.getElementById("shootBtn");t&&(t.addEventListener("touchstart",h=>{h.preventDefault(),x[" "]=!0}),t.addEventListener("touchend",()=>{x[" "]=!1}));const i=document.getElementById("pauseBtn");i&&i.addEventListener("touchstart",h=>{h.preventDefault(),v&&!b&&(f=!f,f?y.pause():y.play().catch(()=>{}))});const l=document.getElementById("shopBtn");l&&l.addEventListener("touchstart",h=>{h.preventDefault(),v&&!b&&(g=!g,g?(f=!0,y.pause()):(f=!1,y.play().catch(()=>{})))});const n=document.getElementById("menuBtn"),a=document.getElementById("mobileMenu");n&&a&&n.addEventListener("touchstart",h=>{h.preventDefault(),a.classList.add("active")});const r=document.getElementById("mobileResumeBtn"),c=document.getElementById("mobileShopBtn"),u=document.getElementById("mobileShareBtn"),m=document.getElementById("mobileDebugBtn"),C=document.getElementById("mobileCloseMenuBtn");r&&r.addEventListener("touchstart",h=>{h.preventDefault(),!b&&v&&(f=!1,g=!1,y.play().catch(()=>{})),a.classList.remove("active")}),c&&c.addEventListener("touchstart",h=>{h.preventDefault(),v&&!b&&(g=!g,g?(f=!0,y.pause()):(f=!1,y.play().catch(()=>{}))),a.classList.remove("active")}),u&&u.addEventListener("touchstart",h=>{h.preventDefault(),Je(),a.classList.remove("active")}),m&&m.addEventListener("touchstart",h=>{h.preventDefault(),v&&(window.debugMode=!window.debugMode,console.log("Debug mode:",window.debugMode)),a.classList.remove("active")}),C&&C.addEventListener("touchstart",h=>{h.preventDefault(),a.classList.remove("active")}),a&&a.addEventListener("touchstart",h=>{h.target===a&&a.classList.remove("active")})}if(w){const t=document.getElementById("joystickContainer");t&&(t.addEventListener("touchstart",$e),t.addEventListener("touchmove",$e),t.addEventListener("touchend",Re),t.addEventListener("touchcancel",Re))}window.addEventListener("click",t=>{t.target!==o&&(window.forceButtonRedraw=!0)});o.addEventListener("mousemove",t=>{if(g){const i=o.getBoundingClientRect(),l=o.width/i.width,n=o.height/i.height,a=(t.clientX-i.left)*l,r=(t.clientY-i.top)*n,c=160,u=60;Ce.forEach((m,C)=>{const h=c+C*u;if(T>=m.cost){const L=o.width/2+50,W=h-5;a>=L&&a<=L+80&&r>=W&&r<=W+40?window.hoveredButton={index:C,item:m}:window.hoveredButton=null}})}});const A=[{key:"pause",label:"⏸ Pause",action:()=>{console.log("Pause button action triggered"),v&&!b&&(f=!f,f?y.pause():y.play().catch(()=>{}),console.log("Pause button clicked: gamePaused =",f,"shopOpen =",g),k(f?"⏸ Game Paused":"▶️ Game Resumed"),window.lastButtonClick={key:"pause",time:Date.now()})}},{key:"stop",label:"⛔ Stop",action:()=>{console.log("Stop button action triggered"),v&&(f=!0,g=!1,y.pause(),console.log("Stop button clicked: gamePaused =",f,"shopOpen =",g),window.lastButtonClick={key:"stop",time:Date.now()})}},{key:"resume",label:"▶️ Resume",action:()=>{console.log("Resume button action triggered"),!b&&v&&(f=!1,g=!1,y.play().catch(()=>{}),console.log("Resume button clicked: gamePaused =",f,"shopOpen =",g),window.lastButtonClick={key:"resume",time:Date.now()})}},{key:"shop",label:"🛒 Shop",action:()=>{console.log("Shop button action triggered"),v&&!b&&(g=!g,g?(f=!0,y.pause()):(f=!1,y.play().catch(()=>{})),console.log("Shop button clicked: gamePaused =",f,"shopOpen =",g),window.lastButtonClick={key:"shop",time:Date.now()})}}];function at(){const n=A.length*65+(A.length-1)*5;let a=o.width-n-18;const r=25;if(window.forceButtonRedraw&&(console.log("Forcing button redraw due to health check"),window.forceButtonRedraw=!1),A.forEach((c,u)=>{e.save(),e.globalAlpha=.92,e.fillStyle="#222",e.fillRect(a,r,65,20),e.strokeStyle="#4fc3f7",e.lineWidth=1,e.strokeRect(a,r,65,20),e.font="10px Arial",e.fillStyle="white",e.textAlign="center",e.textBaseline="middle",e.fillText(c.label,a+65/2,r+20/2+1),e.restore(),c._rect={x:a,y:r,w:65,h:20},window.debugMode&&(e.save(),e.strokeStyle="#ff00ff",e.lineWidth=2,e.strokeRect(a,r,65,20),e.fillStyle="#ff00ff",e.font="8px Arial",e.fillText(`${c.key}`,a+2,r+8),e.restore()),a+=70}),window.debugMode&&Math.random()<.01&&console.log("Button positions updated:",A.map(c=>({key:c.key,rect:c._rect}))),window.buttonsDrawn=!0,window.lastButtonClick&&Date.now()-window.lastButtonClick.time<500){const c=A.find(u=>u.key===window.lastButtonClick.key);c&&c._rect&&(e.save(),e.strokeStyle="#ffff00",e.lineWidth=3,e.strokeRect(c._rect.x-2,c._rect.y-2,c._rect.w+4,c._rect.h+4),e.restore())}}o.addEventListener("click",t=>{if(t.preventDefault(),t.stopPropagation(),w){(!v||b)&&ge();return}const i=o.getBoundingClientRect(),l=o.width/i.width,n=o.height/i.height,a=(t.clientX-i.left)*l,r=(t.clientY-i.top)*n;console.log("Canvas clicked at:",a,r,"Canvas size:",o.width,"x",o.height);let c=!1;for(let u=0;u<A.length;u++){const m=A[u];if(m._rect&&a>=m._rect.x&&a<=m._rect.x+m._rect.w&&r>=m._rect.y&&r<=m._rect.y+m._rect.h){console.log("Button clicked:",m.key,"at position:",m._rect),m.action(),c=!0;return}}if(!c&&r>=20&&r<=50&&a>=o.width-300){console.log("Fallback: Button area clicked but no button detected, trying keyboard shortcuts");const C=65+5,h=a-(o.width-280),B=Math.floor(h/C);if(B>=0&&B<A.length){const L=A[B];console.log("Fallback: Activating button via index:",L.key),L.action();return}}if(!v||b){ge();return}if(g){const u=o.getBoundingClientRect(),m=o.width/u.width,C=o.height/u.height,h=(t.clientX-u.left)*m,B=(t.clientY-u.top)*C;console.log("Shop click detected at:",h,B,"Canvas size:",o.width,"x",o.height,"Rect size:",u.width,"x",u.height);const L=160,W=60;Ce.forEach(($,z)=>{const Ke=L+z*W,ye=T>=$.cost,ee=o.width/2+50,te=Ke-5,me=80,xe=40;if(console.log(`Item ${z} (${$.name}): Button at ${ee},${te} size ${me}x${xe}, canAfford: ${ye}`),ye&&h>=ee&&h<=ee+me&&B>=te&&B<=te+xe){console.log("✅ Buying:",$.name,"for",$.cost,"coins"),st($);return}else if(!ye&&h>=ee&&h<=ee+me&&B>=te&&B<=te+xe){console.log("❌ Not enough coins for:",$.name),Ae(`❌ Not enough coins for ${$.name}`);return}})}if(f&&!g){const u=o.getBoundingClientRect(),m=o.width/u.width,C=o.height/u.height,h=(t.clientX-u.left)*m,B=(t.clientY-u.top)*C;console.log("Pause screen click at:",h,B);const L=o.height/2+80,W=200,$=50,z=o.width/2-W/2;console.log("Share button area:",z,L,W,$),h>=z&&h<=z+W&&B>=L&&B<=L+$&&(console.log("Share button clicked!"),Je())}});w&&o.addEventListener("touchstart",t=>{t.preventDefault(),t.stopPropagation(),(!v||b)&&ge()},{passive:!1});function st(t){if(T>=t.cost){switch(T-=t.cost,t.effect){case"lives":P+=t.value;break;case"bulletSpeed":s.bulletSpeed+=t.value;break;case"maxBullets":s.maxBullets+=t.value;break;case"bulletSize":s.bulletSize+=t.value;break;case"speed":s.speed+=t.value;break;case"diagonalShooting":s.diagonalShooting=t.value;break}Z.play().catch(()=>{}),Ae(t.name)}else Ae(`❌ Not enough coins for ${t.name}`)}function Ae(t){const i={text:`✅ Purchased: ${t}`,x:o.width/2,y:o.height/2,alpha:1,life:120};window.purchaseMessages||(window.purchaseMessages=[]),window.purchaseMessages.push(i)}function rt(){const t=s.radius,i=o.width-s.radius;s.x<t&&(s.x=t),s.x>i&&(s.x=i),window.debugMode&&(s.x===t||s.x===i)&&console.log("Player at boundary:",{x:s.x,minX:t,maxX:i})}function ct(){if(s.bulletCooldown<=0){if(we.play().catch(()=>{}),M.find(l=>l.type==="multi_shot"))[-45,-30,-15,0,15,30,45,90].forEach(n=>{const a=n*Math.PI/180;R.push({x:s.x,y:s.y-20,radius:s.bulletSize,speed:s.bulletSpeed,vx:Math.sin(a)*s.bulletSpeed,vy:-Math.cos(a)*s.bulletSpeed,diagonal:!0})});else{for(let l=0;l<s.maxBullets;l++){const n=(l-(s.maxBullets-1)/2)*8;R.push({x:s.x+n,y:s.y-20,radius:s.bulletSize,speed:s.bulletSpeed,vx:0,vy:-s.bulletSpeed,diagonal:!1})}s.diagonalShooting&&[45,135,225,315].forEach(n=>{const a=n*Math.PI/180;R.push({x:s.x,y:s.y-20,radius:s.bulletSize,speed:s.bulletSpeed,vx:Math.sin(a)*s.bulletSpeed,vy:-Math.cos(a)*s.bulletSpeed,diagonal:!0})})}M.find(l=>l.type==="laser")&&H(s.x,s.y-20,"laser"),R.forEach((l,n)=>{G.push({x:l.x,y:l.y,life:18,color:pe[n%pe.length],radius:l.radius+3})}),s.bulletCooldown=15}}function dt(){var i,l,n,a;s.speed<=0&&(s.speed=8);const t=s.x;if(w&&Ie){const r=s.speed*Math.abs(j);j<-.1?s.x-=r:j>.1&&(s.x+=r)}else x.ArrowLeft&&(s.x-=s.speed),x.ArrowRight&&(s.x+=s.speed);x[" "]&&ct(),(x.ArrowLeft||x.ArrowRight)&&s.x===t&&(console.log("Player movement stuck detected, resetting position"),s.x=o.width/2),(x.p||x.P)&&v&&!b&&(f=!f,f?y.pause():y.play().catch(()=>{})),(x.s||x.S)&&v&&!b&&(g=!g,g?(f=!0,y.pause()):(f=!1,y.play().catch(()=>{}))),(x.d||x.D)&&v&&(window.debugMode=!window.debugMode,console.log("Debug mode:",window.debugMode)),x[1]&&(console.log("Testing pause button via keyboard"),(i=A.find(r=>r.key==="pause"))==null||i.action()),x[2]&&(console.log("Testing stop button via keyboard"),(l=A.find(r=>r.key==="stop"))==null||l.action()),x[3]&&(console.log("Testing resume button via keyboard"),(n=A.find(r=>r.key==="resume"))==null||n.action()),x[4]&&(console.log("Testing shop button via keyboard"),(a=A.find(r=>r.key==="shop"))==null||a.action()),(x.t||x.T)&&(console.log("Testing all buttons via keyboard"),A.forEach((r,c)=>{console.log(`Testing button ${c}: ${r.key}`),setTimeout(()=>r.action(),c*500)})),rt(),s.bulletCooldown>0&&s.bulletCooldown--}function ht(){R.forEach((t,i)=>{t.vx!==void 0&&t.vy!==void 0?(t.x+=t.vx,t.y+=t.vy):t.y-=t.speed,(t.y<-10||t.x<-10||t.x>o.width+10)&&R.splice(i,1),G.push({x:t.x,y:t.y,life:18,color:pe[(i+Math.floor(Math.random()*3))%pe.length],radius:t.radius+3})}),G.forEach((t,i)=>{t.life--,t.life<=0&&G.splice(i,1)})}function ft(){const i=M.find(l=>l.type==="time_slow")?.3:1;E.forEach((l,n)=>{l.y+=l.speed*i,l.y>o.height+50&&E.splice(n,1)})}function ut(){D.forEach((t,i)=>{t.x+=t.speed*t.direction,(t.x<=0||t.x+t.width>=o.width)&&(t.direction*=-1),t.fireCooldown<=0?(F.push({x:t.x+t.width/2,y:t.y+t.height,radius:8,speed:4}),t.fireCooldown=t.fireRate):t.fireCooldown--})}function pt(){F.forEach((t,i)=>{t.y+=t.speed,t.y>o.height+20&&F.splice(i,1)})}function gt(){q.forEach((t,i)=>{t.y+=2,t.y>o.height+20&&q.splice(i,1)})}function wt(){return it.filter(t=>t.level<=d)}function yt(){const t=Date.now(),i=Math.max(2e3-S*100-d*50,800);if(t-ve>i){const l=Math.min(3+Math.floor(S/3)+Math.floor(d/2),8);if(E.length<l){const n=wt();if(n.length>0){const a=n[Math.floor(Math.random()*n.length)];E.push({x:Math.random()*(o.width-60)+30,y:-50,...a,currentHealth:a.health})}}ve=t}}function mt(){if(S%5===0&&D.length===0){const t=fe.find(r=>r.level<=d)||fe[0],i=t.health+d*10,l=t.scale||1,n=120*l,a=120*l;D.push({x:o.width/2-n/2,y:30,width:n,height:a,health:i,maxHealth:i,speed:t.speed,direction:1,fireCooldown:0,fireRate:t.fireRate,img:t.img,name:t.name}),t.name.includes("Mother Dino")?k(`🦖 BOSS WAVE: ${t.name} appears! 🦖`):k(`BOSS WAVE: ${t.name} appears!`),de.play().catch(()=>{})}if(S%15===0&&S>5&&D.length===0){const n={x:o.width/2-120,y:30,width:240,height:240,health:300+d*20,maxHealth:300+d*20,speed:.8,direction:1,fireCooldown:0,fireRate:20,img:Y,name:"Mother Dino Ultimate"};D.push(n),k("🦖 SPECIAL EVENT: Mother Dino Ultimate! 🦖"),de.play().catch(()=>{})}}function xt(){const t=Date.now();if(t-Se>1e4){if(Math.random()<.3){let i=[...ot];(p.subscription||d>=3)&&(i=i.concat(lt));const l=i[Math.floor(Math.random()*i.length)],n={x:Math.random()*(o.width-30)+15,y:-20,...l,radius:15,pulse:0};q.push(n),l.type!=="regen"&&l.type!=="shield"&&H(n.x,n.y,"powerup")}Se=t}}function vt(){if(!_){if(S%10===0&&S>0&&S!==window.lastLevelWave){window.lastLevelWave=S;const t=d+1;if(!Ze(t)){k("🔒 Subscribe to continue to Level "+t);return}if(_=!0,he=90,d++,d>50&&(d=50),p.email){const n=JSON.parse(localStorage.getItem("dinoWarfareUsers")||"{}");n[p.email]&&(n[p.email].maxLevel=Math.max(n[p.email].maxLevel,d),localStorage.setItem("dinoWarfareUsers",JSON.stringify(n)))}E=[],D=[],F=[];const i=d*25;T+=i;const l=N(d);k(`LEVEL ${d}: ${l} COMPLETE! +${i} coins`),d===4&&k("🎉 Free trial completed! Subscribe for unlimited access!")}_||(S%7===0&&S>1&&S!==window.lastRapidFireWave&&(window.lastRapidFireWave=S,k("RAPID FIRE WAVE - Enemies spawn faster!")),S%9===0&&S>1&&S!==window.lastBossRushWave&&(window.lastBossRushWave=S,k("BOSS RUSH - Multiple bosses may appear!")))}}function k(t){window.levelMessages||(window.levelMessages=[]),window.levelMessages.length<3&&window.levelMessages.push({text:t,x:o.width/2,y:o.height/2,alpha:1,life:120})}let oe=0,ue=0,G=[];const pe=["rgba(255,255,100,0.7)","rgba(100,200,255,0.6)","rgba(255,120,40,0.5)"];let V=0,J=0,le=0,De=0,We=0,_e=0,O=[],K=0,Q=0;const St=[{speed:.2,color:"#222",y:480,h:120},{speed:.4,color:"#2d2d2d",y:420,h:60},{speed:.7,color:"#3a3a2d",y:390,h:40}];let bt=Array.from({length:5},(t,i)=>({x:Math.random()*960,y:60+Math.random()*80,speed:.15+Math.random()*.1,w:120+Math.random()*60,h:40+Math.random()*20})),Tt=Array.from({length:8},(t,i)=>({x:Math.random()*960,y:350+Math.random()*60,speed:.5+Math.random()*.2,h:60+Math.random()*30})),Oe=1,ne=0;function kt(){R.forEach((t,i)=>{E.forEach((l,n)=>{const a=t.x-l.x,r=t.y-l.y;Math.sqrt(a*a+r*r)<t.radius+l.radius&&(l.currentHealth--,l.currentHealth<=0&&(I+=l.points,T+=Math.floor(l.points/10),Z.play().catch(()=>{}),E.splice(n,1),V=12,J=12,O.push({x:l.x,y:l.y,text:`+${l.points} pts`,color:"yellow",life:32}),O.push({x:l.x,y:l.y+18,text:`+${Math.floor(l.points/10)} coins`,color:"gold",life:32}),K++,Q=40),R.splice(i,1),H(l.x,l.y,"explosion"),l.radius>=35&&(oe=18,ue=14))}),D.forEach((l,n)=>{const a=t.x-(l.x+l.width/2),r=t.y-(l.y+l.height/2);Math.sqrt(a*a+r*r)<t.radius+Math.max(l.width,l.height)/2&&(l.health--,R.splice(i,1),l.health<=0&&(I+=100,T+=10,Z.play().catch(()=>{}),D.splice(n,1),V=16,J=16,O.push({x:l.x+l.width/2,y:l.y+l.height/2,text:"+100 pts",color:"yellow",life:40}),O.push({x:l.x+l.width/2,y:l.y+l.height/2+18,text:"+10 coins",color:"gold",life:40}),K++,Q=40),H(t.x,t.y,"explosion"),oe=28,ue=22)})}),E.forEach((t,i)=>{const l=s.x-t.x,n=s.y-t.y;Math.sqrt(l*l+n*n)<s.radius+t.radius&&(M.find(c=>c.type==="shield_plus")?(H(t.x,t.y,"explosion"),I+=t.points,T+=Math.floor(t.points/10),E.splice(i,1)):s.shield?(s.shield=!1,ie.play().catch(()=>{}),E.splice(i,1)):(P--,P<=0&&(b=!0,ce.play().catch(()=>{}),y.pause()),E.splice(i,1)))}),F.forEach((t,i)=>{const l=t.x-s.x,n=t.y-s.y;Math.sqrt(l*l+n*n)<t.radius+s.radius&&(s.shield?(s.shield=!1,ie.play().catch(()=>{})):(P--,P<=0&&(b=!0,ce.play().catch(()=>{}),y.pause())),F.splice(i,1))}),q.forEach((t,i)=>{const l=s.x-t.x,n=s.y-t.y;if(Math.sqrt(l*l+n*n)<s.radius+t.radius){switch(H(t.x,t.y,"powerup"),t.type){case"regen":P++,Me.play().catch(()=>{}),k("💚 Health Restored!");break;case"shield":s.shield=!0,ie.play().catch(()=>{}),k("🛡️ Shield Activated!");break;case"laser":At(),k("🔴 LASER MODE ACTIVATED!");break;case"shield_plus":Et(),k("💎 INVINCIBLE SHIELD!");break;case"time_slow":Mt(),k("⏰ TIME SLOW ACTIVATED!");break;case"nuke":Bt(),k("💥 NUKE DETONATED!");break;case"multi_shot":Ct(),k("🎯 MULTI-SHOT MODE!");break}q.splice(i,1)}})}function At(){M.find(t=>t.type==="laser")||M.push({type:"laser",duration:1e4,startTime:Date.now()})}function Et(){M.find(t=>t.type==="shield_plus")||M.push({type:"shield_plus",duration:15e3,startTime:Date.now()})}function Mt(){M.find(t=>t.type==="time_slow")||M.push({type:"time_slow",duration:8e3,startTime:Date.now()})}function Bt(){E.forEach(t=>{H(t.x,t.y,"explosion"),I+=t.points,T+=Math.floor(t.points/10)}),E=[],D.forEach(t=>{t.health=Math.max(0,t.health-50),H(t.x+t.width/2,t.y+t.height/2,"explosion")})}function Ct(){M.find(t=>t.type==="multi_shot")||M.push({type:"multi_shot",duration:12e3,startTime:Date.now()})}function It(){const t=Date.now();M=M.filter(i=>t-i.startTime<i.duration)}function Pt(){if(f||!v||b)return;_&&(he--,he<=0&&(_=!1)),dt(),ht(),ft(),ut(),pt(),gt(),zt(),It(),_||(yt(),mt(),xt(),kt()),window.purchaseMessages&&window.purchaseMessages.forEach((i,l)=>{i.life--,i.alpha=i.life/120,i.y-=.5,i.life<=0&&window.purchaseMessages.splice(l,1)}),window.levelMessages&&window.levelMessages.forEach((i,l)=>{i.life--,i.alpha=i.life/120,i.y-=.3,i.life<=0&&window.levelMessages.splice(l,1)}),window.lastWaveTime||(window.lastWaveTime=Date.now());const t=Date.now();t-window.lastWaveTime>=3e4&&!_&&(S++,window.lastWaveTime=t),vt(),I!==De&&(V=14),T!==We&&(J=14),P!==_e&&(le=14),De=I,We=T,_e=P,V>0&&V--,J>0&&J--,le>0&&le--,O.forEach((i,l)=>{i.y-=.7,i.life--,i.life<=0&&O.splice(l,1)}),Q>0&&Q--,Q===0&&K>1?(O.push({x:o.width/2,y:120,text:`${K} KILL COMBO!`,color:"#ff66cc",life:48,size:28}),K=0):Q===0&&(K=0)}function Lt(){if(oe>0){e.save();const i=(Math.random()-.5)*ue,l=(Math.random()-.5)*ue;e.translate(i,l),oe--}Ft(),e.fillStyle="#000000",e.fillRect(0,0,o.width,o.height);const t=70;if(!v){$t();return}if(b){Rt();return}if(p.avatar&&se.complete&&se.naturalWidth>0?e.drawImage(se,s.x-30,s.y-30,60,60):ae.complete&&ae.naturalWidth>0&&e.drawImage(ae,s.x-30,s.y-30,60,60),s.shield&&(e.beginPath(),e.arc(s.x,s.y,s.radius+10,0,Math.PI*2),e.strokeStyle="cyan",e.lineWidth=3,e.stroke()),R.forEach(i=>{e.beginPath(),e.arc(i.x,i.y,i.radius,0,Math.PI*2),e.fillStyle="yellow",e.fill()}),E.forEach(i=>{i.img&&i.img.complete&&i.img.naturalWidth>0&&e.drawImage(i.img,i.x-i.radius,i.y-i.radius,i.radius*2,i.radius*2)}),D.forEach(i=>{const n=(fe.find(u=>u.name===i.name)||fe[0]).scale||1,a=120*n,r=120*n;i.img&&i.img.complete&&i.img.naturalWidth>0&&e.drawImage(i.img,i.x,i.y,a,r),i.name.includes("Mother Dino")?(e.fillStyle="purple",e.font="bold 18px Arial",e.fillText(`🦖 ${i.name} 🦖`,i.x,i.y-10),e.fillStyle="red",e.fillRect(i.x,i.y-15,a,12),e.fillStyle="purple",e.fillRect(i.x,i.y-15,a*(i.health/i.maxHealth),12),e.fillStyle="white",e.font="16px Arial",e.fillText(`${i.health}/${i.maxHealth}`,i.x+a/2-20,i.y+10)):(e.fillStyle="red",e.font="16px Arial",e.fillText(`BOSS: ${i.name}`,i.x,i.y-10),e.fillRect(i.x,i.y-15,a,10),e.fillStyle="green",e.fillRect(i.x,i.y-15,a*(i.health/i.maxHealth),10),e.fillStyle="white",e.fillText(`${i.health}/${i.maxHealth}`,i.x+a/2-20,i.y+10))}),F.forEach(i=>{e.beginPath(),e.arc(i.x,i.y,i.radius,0,Math.PI*2),e.fillStyle="orange",e.fill()}),q.forEach(i=>{if(i.type!=="regen"&&i.type!=="shield"){i.pulse+=.2;const l=Math.sin(i.pulse)*3;e.beginPath(),e.arc(i.x,i.y,i.radius+l,0,Math.PI*2),e.fillStyle=i.color,e.fill(),e.shadowColor=i.color,e.shadowBlur=10,e.beginPath(),e.arc(i.x,i.y,i.radius,0,Math.PI*2),e.fillStyle=i.color,e.fill(),e.shadowBlur=0}else e.beginPath(),e.arc(i.x,i.y,i.radius,0,Math.PI*2),e.fillStyle=i.color,e.fill()}),Yt(),M.forEach(i=>{const n=(i.duration-(Date.now()-i.startTime))/i.duration;switch(i.type){case"laser":e.save(),e.globalAlpha=n*.3,e.fillStyle="red",e.fillRect(0,s.y-20,o.width,40),e.restore();break;case"shield_plus":e.save(),e.globalAlpha=n*.5,e.beginPath(),e.arc(s.x,s.y,s.radius+20,0,Math.PI*2),e.strokeStyle="cyan",e.lineWidth=5,e.stroke(),e.restore();break;case"time_slow":e.save(),e.globalAlpha=n*.2,e.fillStyle="purple",e.fillRect(0,0,o.width,o.height),e.restore();break;case"multi_shot":e.save(),e.globalAlpha=n,e.fillStyle="yellow",e.font="16px Arial",e.fillText("🎯 MULTI-SHOT ACTIVE",20,o.height-20),e.restore();break}}),!w)e.save(),e.shadowColor="#ffe066",e.shadowBlur=12,e.fillStyle="white",e.font=`bold ${18+(V>0?V/2:0)}px Arial`,e.fillText(`Score: ${I}`,20,30+t),e.font=`bold ${18+(le>0?le/2:0)}px Arial`,e.fillStyle="#4CAF50",e.fillText(`Lives: ${P}`,160,30+t),e.font=`bold ${18+(J>0?J/2:0)}px Arial`,e.fillStyle="gold",e.fillText(`Coins: ${T}`,260,30+t),e.restore(),e.fillStyle="white",e.font="18px Arial",e.fillText(`Wave: ${S}`,380,30+t),p.name&&(e.fillStyle="#4CAF50",e.font="16px Arial",e.fillText(`Player: ${p.name}`,20,55+t));else{const i=document.getElementById("scoreText"),l=document.getElementById("livesText"),n=document.getElementById("coinsText"),a=document.getElementById("levelText");i&&(i.textContent=`Score: ${I}`),l&&(l.textContent=`Lives: ${P}`),n&&(n.textContent=`Coins: ${T}`),a&&(a.textContent=`Level ${d}: ${N(d)}`)}if(window.debugMode){e.fillStyle="#ff00ff",e.font="12px Arial",e.fillText(`Player X: ${Math.round(s.x)} | Speed: ${s.speed}`,20,200+t),e.fillText(`Keys: L=${x.ArrowLeft} R=${x.ArrowRight}`,20,215+t),e.fillText(`Canvas: ${o.width}x${o.height}`,20,230+t),e.save(),e.strokeStyle="#ff00ff",e.lineWidth=2,e.beginPath(),e.moveTo(s.x,0),e.lineTo(s.x,o.height),e.stroke(),e.restore(),e.save(),e.strokeStyle="#00ff00",e.lineWidth=3,e.strokeRect(o.width-280,25,260,20),e.fillStyle="#00ff00",e.font="10px Arial",e.fillText("BUTTON AREA",o.width-270,20),e.restore();let i=!0;A.forEach(l=>{(!l._rect||typeof l._rect.x!="number")&&(i=!1)}),i||(e.fillStyle="#ff0000",e.font="bold 14px Arial",e.fillText("⚠️ BUTTONS NOT RESPONDING",o.width-280,50))}if(d!==Oe&&(ne=40,Oe=d),ne>0?(e.save(),e.globalAlpha=.5+.5*Math.sin(ne/4),e.font="bold 22px Arial",e.fillStyle="#ffe066",e.fillText(`Level ${d}: ${N(d)}`,20,p.name?80+t:50+t),e.restore(),ne--):(e.fillStyle="gold",e.font="16px Arial",e.fillText(`Level ${d}: ${N(d)}`,20,p.name?80+t:50+t)),p.isAdmin?(e.fillStyle="#ff00cc",e.font="bold 16px Arial",e.fillText("👑 ADMIN MODE: All features unlocked",20,p.name?125+t:95+t)):p.subscription?(e.fillStyle="#4CAF50",e.font="14px Arial",e.fillText("✅ Premium Subscriber",20,p.name?105+t:75+t)):d<=3&&(e.fillStyle="#7c5cff",e.font="14px Arial",e.fillText("🎮 Free Trial (Levels 1-3)",20,p.name?105+t:75+t)),g?Dt():f&&Wt(),window.purchaseMessages&&window.purchaseMessages.forEach(i=>{e.save(),e.globalAlpha=i.alpha,e.fillStyle="white",e.font="20px Arial",e.textAlign="center",e.fillText(i.text,i.x,i.y),e.textAlign="left",e.restore()}),oe>0&&e.restore(),O.forEach(i=>{e.save(),e.globalAlpha=Math.max(0,i.life/32),e.font=i.size?`bold ${i.size}px Arial`:"bold 18px Arial",e.fillStyle=i.color,e.textAlign="center",e.fillText(i.text,i.x,i.y),e.textAlign="left",e.restore()}),f&&!g){const i=o.height/2+80,l=200,n=50,a=o.width/2-l/2;e.save(),e.shadowColor="#4fc3f7",e.shadowBlur=24+8*Math.sin(Date.now()/200),e.strokeStyle="#4fc3f7",e.lineWidth=4,e.strokeRect(a-4,i-4,l+8,n+8),e.restore()}w||at()}function $t(){const t=w?24:40,i=w?28:40,l=w?14:20,n=w?12:16;e.fillStyle="white",e.font=`${i}px Arial`,e.fillText("🦖 DINO WARFARE",o.width/2-i*4.5,o.height/2-120),e.font=`${l}px Arial`,e.fillText("Fruit of the Spirit Edition",o.width/2-l*6,o.height/2-80),e.fillStyle="#4CAF50",e.font=`${n}px Arial`,e.fillText("Created by David Oshoba George",o.width/2-n*7.5,o.height/2-50),p.name&&(e.fillStyle="gold",e.font=`${n+2}px Arial`,e.fillText(`Welcome back, ${p.name}!`,o.width/2-n*5.5,o.height/2-20)),e.fillStyle="white",e.font=`${t}px Arial`;const a=w?"Tap to Start":"Click to Start";e.fillText(a,o.width/2-t*3,o.height/2+10),e.font=`${n}px Arial`,e.fillText("Controls:",o.width/2-n*3.5,o.height/2+50),w?(e.fillText("Joystick - Move",o.width/2-n*3.5,o.height/2+70),e.fillText("🎯 Button - Shoot",o.width/2-n*3.5,o.height/2+90),e.fillText("⏸ Button - Pause",o.width/2-n*3.5,o.height/2+110),e.fillText("🛒 Button - Shop",o.width/2-n*3.5,o.height/2+130),e.fillText("☰ Menu - More Options",o.width/2-n*3.5,o.height/2+150)):(e.fillText("Arrow Keys - Move",o.width/2-n*3.5,o.height/2+70),e.fillText("Spacebar - Shoot",o.width/2-n*3.5,o.height/2+90),e.fillText("P - Pause/Resume",o.width/2-n*3.5,o.height/2+110),e.fillText("S - Open/Close Shop",o.width/2-n*3.5,o.height/2+130),e.fillText("D - Debug Mode",o.width/2-n*3.5,o.height/2+150)),e.font=`${n-2}px Arial`,e.fillStyle="gold",e.fillText("Level Themes: Love, Joy, Peace, Patience, Kindness...",o.width/2-n*7.5,o.height/2+180),e.fillText("💡 Buy 'Extra Diagonal Bullets' in shop for additional 4-way fire!",o.width/2-n*7.5,o.height/2+200)}function Rt(){const t=w?24:40,i=w?16:24;e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(0,0,o.width,o.height),e.fillStyle="white",e.font=`${t}px Arial`,e.fillText("GAME OVER",o.width/2-t*2.5,o.height/2-50),e.font=`${i}px Arial`,e.fillText(`Final Score: ${I}`,o.width/2-i*3,o.height/2);const l=w?"Tap to restart":"Click to restart";e.fillText(l,o.width/2-i*3,o.height/2+50)}function Dt(){e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(0,0,o.width,o.height),e.fillStyle="white",e.font="36px Arial",e.fillText("🛒 SHOP",o.width/2-60,80),e.font="24px Arial",e.fillText(`💰 Coins: ${T}`,o.width/2-60,120);const t=160,i=60;Ce.forEach((l,n)=>{const a=t+n*i,r=T>=l.cost;if(e.fillStyle=r?"rgba(255, 255, 255, 0.1)":"rgba(100, 100, 100, 0.3)",e.fillRect(o.width/2-150,a-10,300,50),e.strokeStyle=r?"white":"gray",e.lineWidth=2,e.strokeRect(o.width/2-150,a-10,300,50),e.fillStyle=r?"white":"gray",e.font="20px Arial",e.fillText(l.name,o.width/2-140,a+10),e.font="16px Arial",e.fillText(`Cost: ${l.cost} coins`,o.width/2-140,a+30),r){const c=window.hoveredButton&&window.hoveredButton.index===n;e.fillStyle=c?"lime":"green",e.fillRect(o.width/2+50,a-5,80,40),e.fillStyle="white",e.font="16px Arial",e.fillText("BUY",o.width/2+70,a+20),e.strokeStyle=c?"yellow":"lime",e.lineWidth=c?3:2,e.strokeRect(o.width/2+50,a-5,80,40)}}),e.fillStyle="white",e.font="16px Arial",e.fillText("Click on BUY to purchase items",o.width/2-100,o.height-60),e.fillText("Press SHOP button again to close",o.width/2-100,o.height-40)}function Wt(){e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,o.width,o.height),e.fillStyle="white",e.font="40px Arial",e.fillText("⏸ PAUSED",o.width/2-100,o.height/2-80),e.font="20px Arial",e.fillText(`Level: ${d} - ${N(d)}`,o.width/2-120,o.height/2-40),e.fillText(`Score: ${I} | Lives: ${P} | Coins: ${T}`,o.width/2-140,o.height/2-15),e.font="18px Arial",e.fillText("Press P or PAUSE button to resume",o.width/2-140,o.height/2+15),e.fillText("Press S or SHOP button to open shop",o.width/2-140,o.height/2+40);const t=o.height/2+80,i=200,l=50,n=o.width/2-i/2;e.fillStyle="#4CAF50",e.fillRect(n,t,i,l),e.strokeStyle="lime",e.lineWidth=3,e.strokeRect(n,t,i,l),e.fillStyle="white",e.font="18px Arial",e.textAlign="center",e.fillText("📤 Share Score",o.width/2,t+32),e.textAlign="left",e.fillStyle="#CCCCCC",e.font="14px Arial",e.textAlign="center",e.fillText("Share score with friends",o.width/2,t+55),e.textAlign="left"}function Je(){console.log("Share button clicked!"),console.log("Web Share API available:",!!navigator.share);const t=`🦖 DINO WARFARE SCORE CHALLENGE! 🦖

I scored ${I} points in DinoWarfare!
Level: ${d} - ${N(d)}
Theme: ${Be(d)}

Can you beat my score? 
Challenge accepted? 💪

#DinoWarfare #Gaming #Challenge`;if(navigator.share){console.log("Attempting to use Web Share API...");const i={title:"🦖 DinoWarfare Score Challenge",text:t,url:window.location.href};navigator.share(i).then(()=>{console.log("Score shared successfully via Web Share API"),_t("Score shared successfully!")}).catch(l=>{console.log("Web Share API failed:",l),He()})}else console.log("Web Share API not available, showing social share options..."),He()}function _t(t=null){alert(t?`Score shared successfully!

${t}

Share this with your friends!`:`🎉 Score copied to clipboard!

Share it with your friends and challenge them to beat your score!`)}function He(){console.log("Showing social share options dialog...");const t=`🦖 DINO WARFARE SCORE CHALLENGE! 🦖

I scored ${I} points in DinoWarfare!
Level: ${d} - ${N(d)}
Theme: ${Be(d)}

Can you beat my score? 
Challenge accepted? 💪

#DinoWarfare #Gaming #Challenge`,i=encodeURIComponent(window.location.href),l=encodeURIComponent(t),n={twitter:`https://twitter.com/intent/tweet?text=${l}&url=${i}`,facebook:`https://www.facebook.com/sharer/sharer.php?u=${i}`,whatsapp:`https://wa.me/?text=${l}%20${i}`,telegram:`https://t.me/share/url?url=${i}&text=${l}`,email:`mailto:?subject=DinoWarfare Score Challenge&body=${l}%0A%0A${i}`},a=document.createElement("div");a.setAttribute("role","dialog"),a.setAttribute("aria-modal","true"),a.setAttribute("aria-label","Share your score"),a.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    font-family: Arial, sans-serif;
  `;const r=document.createElement("div");r.style.cssText=`
    background: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    max-width: 400px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  `,r.innerHTML=`
    <h2 style="color: #333; margin-bottom: 20px;">🦖 Share Your Score!</h2>
    <p style="color: #666; margin-bottom: 25px;">Choose how you want to share your amazing score:</p>
    
    <div style="display: grid; gap: 10px; margin-bottom: 20px;">
      <button aria-label="Share on Twitter" onclick="window.open('${n.twitter}', '_blank')" style="background: #1DA1F2; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">
        🐦 Share on Twitter
      </button>
      
      <button aria-label="Share on Facebook" onclick="window.open('${n.facebook}', '_blank')" style="background: #4267B2; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">
        📘 Share on Facebook
      </button>
      
      <button aria-label="Share on WhatsApp" onclick="window.open('${n.whatsapp}', '_blank')" style="background: #25D366; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">
        💬 Share on WhatsApp
      </button>
      
      <button aria-label="Share on Telegram" onclick="window.open('${n.telegram}', '_blank')" style="background: #0088cc; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">
        📱 Share on Telegram
      </button>
      
      <button aria-label="Share via Email" onclick="window.open('${n.email}', '_blank')" style="background: #EA4335; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">
        📧 Share via Email
      </button>
    </div>
    
    <button aria-label="Copy score to clipboard" onclick="copyToClipboard('${t}')" style="background: #4CAF50; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px; margin-right: 10px;">
      📋 Copy to Clipboard
    </button>
    
    <button aria-label="Close share dialog" onclick="this.parentElement.parentElement.remove()" style="background: #666; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">
      ❌ Close
    </button>
  `,a.appendChild(r),document.body.appendChild(a),a.addEventListener("click",c=>{c.target===a&&a.remove()})}function qe(){Pt(),Lt(),requestAnimationFrame(qe)}function Ot(){e.fillStyle="#000000",e.fillRect(0,0,o.width,o.height),e.strokeStyle="#1a1a1a",e.lineWidth=1;for(let t=0;t<o.width;t+=50)e.beginPath(),e.moveTo(t,0),e.lineTo(t,o.height),e.stroke();for(let t=0;t<o.height;t+=50)e.beginPath(),e.moveTo(0,t),e.lineTo(o.width,t),e.stroke()}function Ht(){we.volume=.3,Z.volume=.4,ce.volume=.5,Me.volume=.4,ie.volume=.4,y.volume=.2,de.volume=.4,console.log("Sound system initialized")}window.addEventListener("load",()=>{Ot(),Ht(),w&&(Pe(),nt(),console.log("Mobile controls initialized")),e.fillStyle="#000000",e.fillRect(0,0,o.width,o.height),v||window.startGameFromAuth(),w||setInterval(()=>{e.save(),e.globalAlpha=.7,e.fillStyle="#222",e.fillRect(10,10,260,90),e.globalAlpha=1,e.fillStyle="#fff",e.font="14px monospace",e.fillText(`gameStarted: ${v}`,20,30),e.fillText(`gamePaused: ${f}`,20,50),e.fillText(`gameOver: ${b}`,20,70),e.fillText(`shopOpen: ${g}`,20,90),e.restore()},500),setInterval(()=>{if(v&&!b){let t=!0;A.forEach((i,l)=>{(!i._rect||typeof i._rect.x!="number"||typeof i._rect.y!="number")&&(console.warn(`Button ${l} (${i.key}) has invalid rectangle:`,i._rect),t=!1)}),t||(console.log("Button health check failed - forcing button redraw"),window.forceButtonRedraw=!0)}},2e3),console.log("DinoWarfare initialized successfully"),console.log("Canvas size:",o.width,"x",o.height),console.log("Sound files loaded:",{shoot:we.readyState,hit:Z.readyState,bgMusic:y.readyState})});qe();function Ft(){const t=e.createLinearGradient(0,0,0,o.height);t.addColorStop(0,"#181c24"),t.addColorStop(1,"#232323"),e.fillStyle=t,e.fillRect(0,0,o.width,o.height),St.forEach((i,l)=>{e.save(),e.fillStyle=i.color,e.beginPath(),e.moveTo(0,i.y);for(let n=0;n<=o.width;n+=80)e.lineTo(n,i.y+Math.sin(n/80+l+Date.now()/4e3*i.speed)*10);e.lineTo(o.width,i.y+i.h),e.lineTo(0,i.y+i.h),e.closePath(),e.fill(),e.restore()}),Tt.forEach(i=>{i.x-=i.speed,i.x<-20&&(i.x=980),e.save(),e.globalAlpha=.5,e.fillStyle="#2e3d1f",e.fillRect(i.x,i.y,12,i.h),e.beginPath(),e.arc(i.x+6,i.y,18,Math.PI,0),e.fillStyle="#3e5d2d",e.fill(),e.restore()}),bt.forEach(i=>{i.x-=i.speed,i.x<-i.w&&(i.x=980),e.save(),e.globalAlpha=.18,e.fillStyle="#fff",e.beginPath(),e.ellipse(i.x,i.y,i.w,i.h,0,0,Math.PI*2),e.fill(),e.restore()})}function ge(){Qe(),p.avatar&&(se.src=p.avatar),v=!0,f=!1,b=!1,g=!1,I=0,P=4,T=0,S=1,d=1,_=!1,he=0,ve=Date.now()-1e4,Se=Date.now(),R=[],E=[],D=[],F=[],q=[],X=[],G=[],s.x=o.width/2,s.y=o.height-100,s.shield=!1,s.bulletCooldown=0,s.speed=8,s.bulletSpeed=12,s.maxBullets=3,s.bulletSize=4,s.diagonalShooting=!1,p.subscription&&(s.speed+=2,s.bulletSpeed+=3,s.maxBullets+=1),window.purchaseMessages=[],window.levelMessages=[],window.lastWaveTime=Date.now()-25e3,window.lastLevelWave=0,window.lastRapidFireWave=0,window.lastBossRushWave=0,y.play().catch(()=>{}),console.log("Game started from authentication system"),console.log("Player data:",p)}window.startGameFromAuth=ge;function H(t,i,l){for(let n=0;n<20;n++)X.push({x:t,y:i,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,life:30,maxLife:30,color:l==="explosion"?"orange":"yellow",size:Math.random()*3+2})}function zt(){for(let t=X.length-1;t>=0;t--){const i=X[t];i.x+=i.vx,i.y+=i.vy,i.life--,i.life<=0&&X.splice(t,1)}}function Yt(){typeof G<"u"&&G.forEach(t=>{e.save(),e.globalAlpha=t.life/18,e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.fillStyle=t.color,e.shadowColor=t.color,e.shadowBlur=16,e.fill(),e.restore()}),typeof X<"u"&&X.forEach(t=>{const i=t.life/(t.maxLife||1);e.save(),e.globalAlpha=i,e.fillStyle=t.color,e.beginPath(),e.arc(t.x,t.y,t.size||3,0,Math.PI*2),e.fill(),e.restore()})}
